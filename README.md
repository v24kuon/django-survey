# アンケートアプリケーション最終仕様 v3

## 機能要件

1. ユーザー認証
   - メールアドレスによる認証システム
   - 新規登録時にメール認証が必要
   - ログインユーザーのみアンケート回答可能
   - 1ユーザーにつき1アンケートに1回のみ回答可能

2. ユーザー登録
   - 必須項目
     - メールアドレス
     - パスワード
     - 氏名
     - 電話番号
     - 郵便番号
     - 住所
     - チラシ画像（jpg, jpeg, png, gif）
   - 任意項目（後から入力可能）
     - 団体名
     - 代表者名
     - ブース名
     - ブースの概要
     - ブースの詳細情報

3. ユーザー向け機能
   - アンケート一覧表示
     - 有効期限内のアンケートのみ表示
     - タイトルと概要を表示
   - アンケート詳細表示
     - タイトル
     - 説明文
     - 質問項目一覧（設定された表示順で表示）
   - アンケート回答
     - 必須項目の入力チェック
     - 各質問に対して1回のみ回答
     - 回答の編集・削除機能なし

4. 管理者向け機能
   - 単一の管理者権限レベル
   - アンケートカテゴリー管理
     - カテゴリーの作成・編集・削除
     - 表示順序の設定（ドラッグ&ドロップで変更可能）
     - 新規作成時は自動的に最後尾の順序を設定
   - アンケート管理
     - 作成・編集・削除
     - カテゴリーの設定（任意）
     - 公開期間の設定
   - 質問項目管理（nested-admin対応）
     - インライン形式での作成・編集・削除
     - 表示順序の設定
     - 必須/任意の設定
     - 質問タイプの選択
       - 一行テキスト
       - 複数行テキスト
       - ラジオボタン
       - チェックボックス
       - セレクトボックス
     - 選択肢の直接追加（選択式質問の場合）
   - 回答の閲覧
     - ユーザー、質問、回答内容での検索
     - アンケート、ユーザー、回答日時でのフィルタリング

## データモデル構造
1. User（カスタムユーザー）モデル
   - メールアドレス（一意）
   - パスワード
   - 氏名
   - 電話番号
   - 郵便番号
   - 住所
   - チラシ画像
   - 団体名（任意）
   - 代表者名（任意）
   - ブース名（任意）
   - ブースの概要（任意）
   - ブースの詳細情報（任意）
   - アクティブフラグ
   - メール認証済みフラグ
   - 管理者フラグ
   - 登録日

2. UserActivateToken（認証トークン）モデル
   - トークン（UUID）
   - ユーザーへの参照（ForeignKey）
   - 作成日
   - 有効期限（24時間）

3. SurveyCategory（アンケートカテゴリー）モデル
   - カテゴリー名（100文字以内）
   - 説明（任意）
   - 表示順序（整数）
   - 作成日
   - 更新日

4. Survey（アンケート）モデル
   - タイトル（200文字以内）
   - カテゴリー（ForeignKey）
   - 説明
   - 概要（500文字以内）
   - 公開開始日時
   - 公開終了日時
   - 作成日
   - 更新日

5. Question（質問）モデル
   - アンケートへの参照（ForeignKey）
   - 質問文（200文字以内）
   - 質問タイプ（選択肢）
   - 表示順序（整数）
   - 必須回答フラグ

6. QuestionChoice（選択肢）モデル
   - 質問への参照（ForeignKey）
   - 選択肢テキスト（200文字以内）
   - 表示順序（整数）

7. Answer（回答）モデル
   - ユーザー（ForeignKey）
   - 質問への参照（ForeignKey）
   - 回答テキスト
   - 選択された選択肢（ManyToMany、選択式の場合）
   - 作成日
   - 更新日

## 制約条件
- 1ユーザーにつき1アンケートに1回のみ回答可能
- アンケートは公開期間内のみ表示・回答可能
- 回答データの編集・削除は不可
- 回答の閲覧は管理者のみ可能
- 必須項目が未回答の場合は回答完了不可
- テキスト入力の文字数制限
  - 一行テキスト: 255文字
  - 複数行テキスト: 5000文字

## UI/UX要件
- 管理画面での3階層編集（アンケート > 質問 > 選択肢）
- カテゴリーの表示順序はドラッグ&ドロップで変更可能
- 質問と選択肢の表示順序は数値で管理
- アンケート、質問、選択肢の一括編集が可能
- 必須項目は画面上で明確に識別可能

## エラーハンドリング
- CSRF対策（Djangoの標準機能を使用）
- 入力値バリデーションエラーの表示
- 文字数制限超過時のエラー表示
- メール認証の有効期限切れ
- 無効な認証トークン
